# yolo系列笔记

## 1.资料



## 2.笔记

### 2.1 yolov8seg

**Box (Bounding Box，边界框) 指标**： 评估模型**检测**物体的能力（即找到物体并画个框）。

**P (Precision，精确率)**： 模型预测出的所有框中，**正确框**的比例。高精确率意味着模型“宁可错过，绝不抓错”，它认为是的物体，很大概率真的是。你抓了10条鱼，有9条是目标品种，精确率就是90%。

**R (Recall，召回率)**： 所有**真实存在**的物体中，被模型成功找出来的比例。高召回率意味着模型“宁可抓错，绝不放过”，它几乎能找到所有目标。池塘里有10条目标鱼，你抓上来8条，召回率就是80%。

**mAP50 (mean Average Precision)**： 这是核心中的核心指标。它是在IoU（交并比）阈值为0.5时计算的平均精度均值。IoU衡量预测框和真实框的重合程度。阈值设为0.5是一个通用标准，意味着只要预测框和真实框有超过50%的重合，就算预测正确。**这个值越高，说明模型的检测综合能力越强。**

**mAP50-95**： 这是更**严格**的指标。它是在IoU阈值从0.5到0.95（步长为0.05）这个区间内，取多个阈值点分别计算mAP，然后求平均值。这个指标同时考验了模型定位的**精确度**（框的位置要非常准）。**这个值越高，说明模型不仅能找到物体，框的位置还非常精准。**

**Mask (掩码) 指标**： 评估模型**分割**物体的能力（即精确勾勒出物体的轮廓）。这是YOLOv8-**seg**（实例分割）模型特有的指标。

**P, R, mAP50, mAP50-95**： 这些指标的含义与Box指标完全一致，只不过计算的对象从“方框”变成了“像素级的掩码”。它评估的是模型勾勒出的轮廓与真实轮廓的匹配程度。

**P (精确率) vs R (召回率)**： 它们是模型性能的“天平两端”。提升一个往往会导致另一个下降。我们的目标是找到一个最佳平衡点。

**IoU（Intersection over Union）**： 衡量预测结果与真实标签之间的重叠程度。

- **对于目标检测（Box）**：计算的是两个矩形框面积的交集和并集之比。
- **对于实例分割（Mask）**：计算的是两个像素级掩码（轮廓）的交集和并集之比。

**公式**：`IoU = Area of Overlap / Area of Union`

设定一个IoU阈值（例如0.5）。如果预测结果的IoU >= 阈值，则认为是正确预测，否则为错误预测。

**TP（True Positive，真正例）**： 模型正确预测出的正样本。例如，图片中有一个苹果，模型也正确地检测/分割出了一个苹果（且IoU >= 阈值）。

**FP（False Positive，假正例）**： 模型错误预测出的正样本。例如，图片中没有香蕉，模型却检测出了一个香蕉（误检）；或者把一个苹果预测成了香蕉（分类错误）。

**FN（False Negative，假负例）**： 模型没有检测到的正样本。例如，图片中有一个苹果，但模型没有找到它（漏检）。

**TN（True Negative，真负例）**： 正确检测到的负样本。在目标检测中，由于物体数量不固定，背景复杂，TN难以定义，**通常不用于P和R的计算**。

**精确率（Precision）**： **在所有预测为正的样本中，预测正确的比例。**

- **公式**：`P = TP / (TP + FP)`
- **关注点**：模型的“准确度”，是否可靠。

**召回率（Recall）**： **在所有真实为正的样本中，被模型成功预测出来的比例。**

- **公式**：`R = TP / (TP + FN)`
- **关注点**：模型的“查全率”，是否全面。

**重要提示**：在计算整个数据集的P和R时，需要将所有图片的所有预测结果（包括所有类别）汇总起来，计算全局的TP, FP, FN，然后再用上述公式计算。





| 指标类型      | TP/FP/FN 判定基础                 | 计算细节                                                     |
| :------------ | :-------------------------------- | :----------------------------------------------------------- |
| **Box 指标**  | **边界框（Bounding Box）**        | 1. 预测框与所有真实框计算IoU。 2. 找到最大IoU的真实框，并且类别预测正确。 3. 如果最大IoU >= 阈值，则为TP；否则为FP。 4. 每个真实框如果没有被任何预测框匹配到（IoU>=阈值），则产生一个FN。 |
| **Mask 指标** | **分割掩码（Segmentation Mask）** | 1. 在Box判定为TP的基础上（保证了框的位置和类别基本正确）。 2. 计算**预测掩码**与**对应真实掩码**之间的像素级IoU。 3. **注意**：这里用于判定TP/FP的IoU阈值仍然是基于框的，但mAP计算中会使用掩码IoU来评估分割质量。Mask的AP衡量的是掩码轮廓的精确度。 |

| 指标              | 核心计算公式                           | 物理意义                                       |
| :---------------- | :------------------------------------- | :--------------------------------------------- |
| **Precision (P)** | `P = TP / (TP + FP)`                   | 模型预测结果的可靠性                           |
| **Recall (R)**    | `R = TP / (TP + FN)`                   | 模型找出所有目标的能力                         |
| **AP**            | `AP = ∫ P(R) dR`(P-R曲线下面积)        | 单一类别在不同召回率下的综合精度               |
| **mAP**           | `mAP = (Σ AP_i) / N`(对所有类别求平均) | 整个模型在所有类别上的综合性能                 |
| **mAP50**         | `mAP@IoU=0.5`                          | 宽松标准下的综合性能（框/掩码有50%重叠就算对） |
| **mAP50-95**      | `(Σ mAP@IoU=t) / 10`, t=0.5:0.05:0.95  | 严格标准下的综合性能（要求定位极其精准）       |



**mAP（平均精度均值）的计算公式**

这是最复杂但也最重要的指标。它的计算分为几步：

步骤一：计算某一类别的AP（Average Precision，平均精度）

1. **获取预测结果**： 在验证集的所有图片上运行模型，得到每个预测框/掩码的置信度分数。
2. **按置信度排序**： 将该类别**所有**的预测结果（包括TP和FP）按置信度从高到低排序。
3. **计算P-R曲线**：将排序后的预测结果依次认定为正样本。每增加一个预测结果，就计算当前的 Precision 和 Recall。以Recall为横轴，Precision为纵轴，绘制出的曲线就是P-R曲线。**特点**：Recall增加时，Precision通常会下降，曲线呈锯齿状。
4. **计算P-R曲线下面积即为AP**：理论上，`AP = ∫ P(R) dR`（积分）。实践中，通常采用**插值法**进行近似计算。常见的方法是计算所有Recall水平上Precision的最大值的平均值。**一种常见的近似计算**：`AP = Σ (Rₙ - Rₙ₋₁) * P_interp(Rₙ)`其中 `P_interp(Rₙ)`是在召回率 `Rₙ`处插值的精度，通常取 `Rₙ`之后的所有召回率对应的精度的最大值。

步骤二：计算mAP（mean Average Precision）

- **公式**：`mAP = (所有类别的AP值之和) / (类别总数)`

**所以，mAP50 就是固定IoU阈值为0.5时，对所有类别计算AP，再求平均。**

**mAP50-95 就是设定IoU阈值从0.5到0.95，步长0.05（共10个阈值：0.5, 0.55, 0.6, ..., 0.95），分别计算每个阈值下的mAP，最后对这10个mAP值再取平均值。** 这是一个**极其严格**的指标。